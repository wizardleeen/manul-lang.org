---
import { getCollection } from 'astro:content'
import { getLangFromUrl } from '../../../i18n/ui'
import { languages } from '../../../i18n/ui';
import Layout from '../../../layouts/Layout.astro'
import '../../../styles/global.css'

export function getStaticPaths() {
    return Object.keys(languages).map(l => ({
        params: {lang: l}
    }))
}

const lang = getLangFromUrl(Astro.url)

const posts = (await getCollection('blog', post => post.slug.startsWith(`${lang}/`)))
        .sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf());
---

<Layout>
    <div class="max-w-content mx-auto pt-10 px-4 py-12">
        <div class="flex flex-col gap-4">
            {
                posts.map(post => {
                    const [lang, ...slugParts] = post.slug.split('/')
                    const url = `/${lang}/blog/${slugParts.join('/')}`
                    return (
                        <a href={url}>
                            <article class="space-y-4 border border-gray-950/20 dark:border-gray-50/10 rounded p-4">
                                <h2 class="text-xl font-bold">{post.data.title}</h2>
                                <p class="text-gray-500/50 dark:text-white/50">{post.data.date.toISOString().split('T')[0]}</p>
                                <p>{post.data.desc}</p>
                            </article>
                        </a>
                    )
                })
            }
        </div>
    </div>
</Layout>